# 지금 우리 학교는: 연암공과대학교

## 컨셉

연암공과대학교 캠퍼스에 좀비 바이러스가 퍼졌다.
구조대는 **30일 후** 도착한다. 그때까지 살아남아야 한다.
학과별로 다른 시작점과 전문 기술을 가진 6명의 학생 중 하나가 되어, 텍스트 선택지를 통해 매일 생존 결정을 내린다.
자원 하나라도 바닥나면 게임 오버.

---

## 배경과 분위기

- **공간**: 연암공과대학교 실제 시설 (전기실습동, 기계실습동, 스마트관, CNC실, 소프트웨어 프로젝트랩, 학생식당, 본관 카페)
- **시간**: 20XX년 4월, 학기 중 갑작스러운 발생
- **톤**: 공포보다는 긴장감. 각 학과생이 자기 전공을 살려 생존 도구로 전용하는 아이러니를 중심 서사로 삼는다
  - 예. 회로 설계 과제 → 전기 함정
  - 예. AI 학습 모델 → 탈출 경로 계산

---

## 게임 진행

### 화면 흐름

```
랜딩 (닉네임 입력) → 학과 선택 → 인트로 내레이션 → 게임 플레이 (30턴) → 결과 화면 (자동저장) → 랭킹
```

- 랜딩 화면에 닉네임 입력 필드 추가. 게임 시작 전 확정, 게임 중 변경 불가.
- 결과 화면은 게임 종료 즉시 자동 저장. 별도 저장 버튼 없음. 승리·패배 모두 저장.
- Supabase 저장 실패 시: 에러 메시지 표시 + 재시도 버튼. 게임 진행에는 영향 없음.
- **모바일 웹(iOS Safari, Android Chrome) 반응형 지원.** 네이티브 앱은 스코프 외.

### 닉네임 정책

- 길이: 2~10자 (공백 앞뒤 trim 후 기준)
- 허용: 한글·영문·숫자·특수문자·이모지 모두 허용
- 금지: trim 후 길이 미달(1자 이하) 또는 초과(11자 이상)
- 중복 닉네임: 허용 (같은 이름이 랭킹에 여럿 존재 가능)

### 인트로 내레이션

학과를 선택하면, 해당 학과생의 **바이러스 발생 순간**이 5~6줄의 텍스트로 순차 페이드인된다.
선택지 없이 읽기만 하는 짧은 몰입 구간.
건너뛰기 가능.

예시 (스마트기계공학과):

> "20XX년 4월. 연암공대 스마트제조관 1층 CNC 실습실."
> "3D 프린터를 돌리며 졸업 작품 마감을 준비하던 중이었다."
> "학교 단체 채팅방에 사진 하나가 올라왔다: '본관 앞 지금 이게 뭐야?'"
> "프린터는 멈추지 않았다. 뭔가 만들어야 할 것 같았다."

### 매 턴 구조

1. **이벤트 카드 등장** — 상황 설명이 타이프라이터 효과로 출력
2. **행동 선택** (필수, 둘 중 하나)
   - **선택지 3개 중 하나** — 자원 증감 효과 즉시 반영
   - **학과 스킬 사용** — 선택지 대신 스킬로 턴을 소비. 최대 3회, -30점/회 패널티

> **설계 의도**: 매 턴 선택지와 스킬은 **택일**이다. 둘 다 쓰는 것은 불가.
> 스킬은 이벤트 상황에 대한 별도 대응 수단이며, 선택지와 동등한 위치에 있다.

### 게임 중단 처리

- 게임 진행 중 새로고침 / 뒤로가기 / 탭 닫기: 게임 상태 초기화, 랜딩 화면으로 이동
- 게임 상태는 클라이언트 메모리(useState)에만 존재. localStorage 저장 없음.
- 결과 화면을 통과하지 않으면 Supabase에 저장되지 않음.

---

## 자원 시스템

4가지 자원을 동시에 관리한다. **하나라도 0이 되면 해당 엔딩으로 즉시 종료.**

| 자원   | 아이콘 | 0이 되면  |
| ------ | ------ | --------- |
| 체력   | 🫁     | 감염      |
| 식량   | 🍞     | 아사      |
| 생존자 | 👥     | 고립      |
| 멘탈   | 🧠     | 정신 붕괴 |

- 초기값 75 / 최대 100
- 매 턴 체력 +2 자동 회복 (요새화된 은신처), 이벤트 효과 적용 전 처리
- 25% 이하 → 빨간색 pulse 경고 표시

### 자원 동시 소진 우선순위

같은 턴에 두 자원이 동시에 0이 되면 아래 우선순위로 엔딩을 결정한다.

```
체력(감염) > 식량(아사) > 생존자(고립) > 멘탈(정신 붕괴)
```

---

## 학과 시스템

학과 선택이 곧 플레이 스타일을 결정한다. 같은 이벤트라도 학과에 따라 보너스 선택지 효과가 달라진다.

| 학과                    | 전문 능력                   | 보너스 자원 |
| ----------------------- | --------------------------- | ----------- |
| ⚡ 전기전자공학과       | 전력망 복구, 전기 트랩 설치 | 체력        |
| ⚙️ 기계공학과           | 바리케이드 제작, 즉석 무기  | 체력        |
| 📡 스마트전기전자공학과 | IoT 센서로 캠퍼스 감시      | 멘탈        |
| 🦾 스마트기계공학과     | 생존 장비 대량 제작         | 식량        |
| 💻 스마트소프트웨어학과 | AI로 좀비 패턴 분석         | 멘탈        |
| 🎲 자유전공학과         | 제약 없음, 하지만...        | 체력        |

### 학과 스킬 (각 3회, -30점/회)

각 학과는 전공과 직결된 스킬을 사용할 수 있다. 스킬마다 고유한 리소스 트레이드오프가 있다.
스킬 사용 1회당 -30점 패널티 (3회 모두 사용 시 최대 -90점).

### 자유전공 특성

- **스킬**: 50% 확률로 대박 또는 대참사. 결과 예측 불가.
- **효과 대상**: 현재 가장 낮은 자원 1개에 적용.
  - 대박: 해당 자원 +20 × 60% 보정 = 실질 **+12**
  - 대참사: 해당 자원 -20 (보정 없음, 100% 적용)
- **설계 의도**: 도전과 변동성을 원하는 플레이어용 하드모드.

---

## 이벤트 구성

30턴을 세 페이즈로 구분한다.

| 페이즈 | 턴 범위   | 분위기                 |
| ------ | --------- | ---------------------- |
| early  | 1 ~ 10턴  | 초기 혼란, 생존 준비   |
| mid    | 11 ~ 20턴 | 본격 생존전, 갈등 발생 |
| late   | 21 ~ 30턴 | 극한 상황, 탈출 임박   |

### 이벤트 선택 우선순위

1. **턴 1**: 학과별 고정 시작 이벤트
2. **필수 내러티브 이벤트**: 지정 턴 이상이 되면 아직 미노출 시 강제 등장
   - `m06` (무전 신호) → 16턴
   - `l05` (구조 통신) → 22턴
   - `l06` (마지막 밤) → 29턴
3. **특수 위기 이벤트**: mid 시작(11턴)부터 25% 확률. **선택지 효과가 숨겨진 채** 판단해야 한다.
4. **일반 이벤트**: 직전 턴 선택지의 태그(tag)와 동일한 태그를 가진 이벤트 우선 등장 (recentTags 로직, 최근 2턴 기준)

예: 바이러스 변이 확인, 구조 지연 통보, 군 헬기 격추

> [!WARNING] OPEN ITEM: 이벤트 풀 규모가 30턴 × 페이즈 분포를 커버하기에 충분한지 확인 필요. 부족 시 추가 이벤트 작성 필요.

---

## 엔딩

### 판정 우선순위 (30턴 완주 시)

```
1. 모든 자원 ≥ 65  → 완벽한 생존
2. 자원 중 하나라도 ≤ 40  → 아슬아슬한 탈출
3. 그 외 (41~64 구간)  → 구조 완료
```

| 엔딩            | 조건                              | 분류 |
| --------------- | --------------------------------- | ---- |
| 완벽한 생존     | 30턴 완주 + 모든 자원 ≥ 65        | 승리 |
| 구조 완료       | 30턴 완주 + 모든 자원 41~64       | 승리 |
| 아슬아슬한 탈출 | 30턴 완주 + 자원 중 하나라도 ≤ 40 | 승리 |
| 감염            | 체력 0                            | 패배 |
| 아사            | 식량 0                            | 패배 |
| 고립            | 생존자 0                          | 패배 |
| 정신 붕괴       | 멘탈 0                            | 패배 |

---

## 점수와 랭킹

게임 결과는 Supabase에 저장되고, 전체 유저와 점수를 경쟁한다.
승리·패배 모두 저장되며 패배 시도 실제 점수 그대로 기록된다.

**점수 구성**

- 생존 턴 × 20 (최대 600점)
- 최종 자원 평균값 (최대 100점)
- 퍼펙트 보너스 +150 (전 자원 ≥ 65 + 30턴 완주)
- 학과 스킬 사용 시 -30점/회 (최대 -90점)

최대 총점: 850점

> 스킬을 3회 모두 사용해 완벽하게 클리어한 경우 실질 최고점은 760점이다.

### 랭킹 화면

- 전체 기록 중 **상위 10명** 표시 (점수 내림차순)
- 내 최신 기록은 10위권 밖이어도 별도로 표시
- 학과 필터 없음 (전체 학과 통합 랭킹)
- 표시 항목: 순위 / 닉네임 / 학과 / 점수 / 엔딩 유형

### Supabase 스키마

| 컬럼               | 타입        | 제약조건            | 설명                                                                                             |
| ------------------ | ----------- | ------------------- | ------------------------------------------------------------------------------------------------ |
| survival_result_id | BIGSERIAL   | PK, 자동 증가       | 자동 증가 ID                                                                                     |
| nickname           | TEXT        | NOT NULL            | 플레이어 닉네임 (trim 후 저장)                                                                   |
| department         | TEXT        | NOT NULL            | 선택한 학과 ID                                                                                   |
| score              | INT         | NOT NULL, DEFAULT 0 | 최종 점수 (0~850)                                                                                |
| turns_survived     | INT         | NOT NULL            | 생존 턴 수 (0~30)                                                                                |
| ending             | TEXT        | NOT NULL            | 엔딩 유형 (perfect_rescue / rescued / narrow_escape / infected / starvation / alone / breakdown) |
| created_at         | TIMESTAMPTZ | DEFAULT now()       | 기록 생성 시각                                                                                   |

보안: Supabase RLS로 익명 INSERT만 허용. 서버 측 점수 검증 없음 (소규모 서비스).

---

## 디자인 방향

- **다크 테마** — 어두운 배경에 붉은 accent 색상
- **글리치/노이즈 효과** — 타이틀에 flicker 애니메이션 적용
- **타이프라이터** — 이벤트 텍스트가 실시간으로 출력되어 긴장감 부여
- **자원 경고** — 25% 이하 자원은 붉은 pulse 애니메이션으로 위기감 표현
- **반응형** — 모바일 웹(iOS Safari, Android Chrome) 정상 동작

---

## 스코프 외 (구현하지 않는 것)

다음 항목은 이 프로젝트의 범위에 포함되지 않는다.

- **멀티플레이어 / 실시간 대전** — Firebase 등 별도 인프라 필요
- **모바일 앱 (네이티브)** — Next.js 웹 전용
- **한국어 외 다국어 지원** — 연암공대 특화 한국어 콘텐츠
- **커머셜 서비스 / 결제** — 무료 게임
- **긴급 보급 시스템** — 학과 스킬로 단일화 (제거됨)
- **서버 측 점수 검증** — 소규모 서비스, RLS만으로 충분
